@model SeniorManagement.Models.ReportViewModel
@{
    ViewData["Title"] = "";
    
    // Declare variables at the top so they're accessible throughout the view
    bool hasSeniorFilters = !string.IsNullOrEmpty(Model.SelectedStatus) || 
                           !string.IsNullOrEmpty(Model.SelectedZoneFilter) || 
                           !string.IsNullOrEmpty(Model.SelectedGender) || 
                           !string.IsNullOrEmpty(Model.SelectedCivilStatus) ||
                           !string.IsNullOrEmpty(Model.SelectedAgeRange) || 
                           !string.IsNullOrEmpty(Model.SelectedBirthDate) ||
                           !string.IsNullOrEmpty(Model.SelectedPensionType) || 
                           !string.IsNullOrEmpty(Model.SeniorSearchTerm);
    
    bool hasEventFilters = !string.IsNullOrEmpty(Model.SelectedEventStatus) || 
                          !string.IsNullOrEmpty(Model.SelectedEventType) || 
                          !string.IsNullOrEmpty(Model.SelectedEventDateFilter) || 
                          !string.IsNullOrEmpty(Model.EventSearchTerm) ||
                          !string.IsNullOrEmpty(Model.SelectedFromDate) || 
                          !string.IsNullOrEmpty(Model.SelectedToDate);
    
    // Parse age range for display
    string minAgeDisplay = "";
    string maxAgeDisplay = "";
    if (!string.IsNullOrEmpty(Model.SelectedAgeRange))
    {
        var ageParts = Model.SelectedAgeRange.Split('-');
        if (ageParts.Length == 2)
        {
            minAgeDisplay = ageParts[0];
            maxAgeDisplay = ageParts[1];
        }
        else if (Model.SelectedAgeRange.Contains("+"))
        {
            minAgeDisplay = Model.SelectedAgeRange.Replace("+", "");
            maxAgeDisplay = "120";
        }
    }
}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-2 text-gray-800">Comprehensive Reports</h1>
            <p class="mb-0">View and export senior citizens and events data</p>
        </div>
        <div>
            <span class="text-muted small">
                <i class="fas fa-calendar me-1"></i>@DateTime.Now.ToString("MMMM dd, yyyy")
            </span>
        </div>
    </div>

    <!-- Senior Citizens Report Section -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-users me-2"></i>Senior Citizens Registry
            </h6>
            <span class="badge bg-info">@Model.TotalSeniors Seniors</span>
        </div>
        <div class="card-body">
            <!-- Senior Filter Section -->
            <div class="mb-4">
                <form method="get" class="row g-3" id="seniorFilterForm">
                    <input type="hidden" name="eventStatus" value="@Model.SelectedEventStatus" />
                    <input type="hidden" name="eventType" value="@Model.SelectedEventType" />
                    <input type="hidden" name="eventDateFilter" value="@Model.SelectedEventDateFilter" />
                    <input type="hidden" name="eventSearch" value="@Model.EventSearchTerm" />
                    <input type="hidden" name="fromDate" value="@Model.SelectedFromDate" />
                    <input type="hidden" name="toDate" value="@Model.SelectedToDate" />

                    <!-- Status Filter -->
                    <div class="col-md-2">
                        <label class="small font-weight-bold">Status</label>
                        <select class="form-control form-control-sm" name="status">
                            <option value="">All Status</option>
                            <option value="Active" selected="@(Model.SelectedStatus == "Active")">Active</option>
                            <option value="Archived" selected="@(Model.SelectedStatus == "Archived")">Archived</option>
                        </select>
                                            </div>
                        <!-- Zone Filter -->
                        <div class="col-md-2">
                            <label class="small font-weight-bold">Zone</label>
                            <select class="form-control form-control-sm" name="zone">
                                <option value="">All Zones</option>
                                @if (Model.AvailableZones != null && Model.AvailableZones.Any())
                                {
                                    foreach (var zone in Model.AvailableZones)
                                    {
                                        <option value="@zone.ZoneNumber" selected="@(Model.SelectedZoneFilter == zone.ZoneNumber.ToString())">
                                            Zone @zone.ZoneNumber - @zone.ZoneName
                                        </option>
                                    }
                                }
                                else
                                {
                                    <!-- Fallback if no zones in database -->
                                    @for (int i = 1; i <= 7; i++)
                                    {
                                        <option value="@i" selected="@(Model.SelectedZoneFilter == i.ToString())">Zone @i</option>
                                    }
                                }
                            </select>
                        </div>
                    <!-- Gender Filter -->
                    <div class="col-md-2">
                        <label class="small font-weight-bold">Gender</label>
                        <select class="form-control form-control-sm" name="gender">
                            <option value="">All Genders</option>
                            <option value="Male" selected="@(Model.SelectedGender == "Male")">Male</option>
                            <option value="Female" selected="@(Model.SelectedGender == "Female")">Female</option>
                        </select>
                    </div>

                    <!-- Civil Status Filter -->
                    <div class="col-md-2">
                        <label class="small font-weight-bold">Civil Status</label>
                        <select class="form-control form-control-sm" name="civilStatus">
                            <option value="">All Status</option>
                            <option value="Single" selected="@(Model.SelectedCivilStatus == "Single")">Single</option>
                            <option value="Married" selected="@(Model.SelectedCivilStatus == "Married")">Married</option>
                            <option value="Widowed" selected="@(Model.SelectedCivilStatus == "Widowed")">Widowed</option>
                            <option value="Separated" selected="@(Model.SelectedCivilStatus == "Separated")">Separated</option>
                        </select>
                    </div>

                    <!-- Age Range Filter - Custom Input -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">Age Range</label>
                        <div class="input-group input-group-sm">
                            <input type="number" 
                                   class="form-control" 
                                   id="minAge" 
                                   min="60" 
                                   max="120" 
                                   placeholder="Min" 
                                   value="@minAgeDisplay"
                                   onchange="updateAgeRange()">
                            <div class="input-group-prepend input-group-append">
                                <span class="input-group-text">to</span>
                            </div>
                            <input type="number" 
                                   class="form-control" 
                                   id="maxAge" 
                                   min="60" 
                                   max="120" 
                                   placeholder="Max" 
                                   value="@maxAgeDisplay"
                                   onchange="updateAgeRange()">
                            <input type="hidden" id="ageRange" name="ageRange" value="@Model.SelectedAgeRange" />
                        </div>
                        <small class="form-text text-muted">Enter age range (60-120)</small>
                    </div>

                    <!-- Pension Type Filter -->
                    <div class="col-md-2">
                        <label class="small font-weight-bold">Pension Type</label>
                        <select class="form-control form-control-sm" name="pensionType">
                            <option value="">All Pension Types</option>
                            @foreach (var pensionType in Model.AvailablePensionTypes)
                            {
                                bool isSelected = Model.SelectedPensionType == pensionType;
                                <option value="@pensionType" selected="@isSelected">@pensionType</option>
                            }
                        </select>
                    </div>

                    <!-- Birth Date Filter - Date Picker -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">Birth Date</label>
                        <div class="input-group input-group-sm">
                            <input type="text" 
                                   class="form-control datepicker" 
                                   id="birthDatePicker"
                                   name="birthDate"
                                   value="@Model.SelectedBirthDate"
                                   placeholder="Select birth date"
                                   autocomplete="off">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button" onclick="clearBirthDate()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <small class="form-text text-muted">Select specific birth date</small>
                    </div>

                    <!-- Search by Name or SCCN -->
                    <div class="col-md-5">
                        <label class="small font-weight-bold">Search by Name, SCCN, or Pension</label>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" name="seniorSearch"
                                   value="@Model.SeniorSearchTerm" placeholder="Search by name, SCCN, pension type...">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Buttons -->
                    <div class="col-md-4 d-flex align-items-end">
                        <button type="submit" class="btn btn-sm btn-primary mr-2">
                            <i class="fas fa-filter me-1"></i> Apply Filters
                        </button>
                        @if (hasSeniorFilters)
                        {
                            <a href="@Url.Action("Index", "Report", new {
                                eventStatus = Model.SelectedEventStatus,
                                eventType = Model.SelectedEventType,
                                eventDateFilter = Model.SelectedEventDateFilter,
                                eventSearch = Model.EventSearchTerm,
                                fromDate = Model.SelectedFromDate,
                                toDate = Model.SelectedToDate
                            })" class="btn btn-sm btn-secondary">
                                <i class="fas fa-times me-1"></i> Clear Senior Filters
                            </a>
                        }
                    </div>
                </form>

                <!-- Results Summary -->
                @if (!string.IsNullOrEmpty(Model.SelectedStatus) || !string.IsNullOrEmpty(Model.SelectedZoneFilter) || 
                   !string.IsNullOrEmpty(Model.SelectedGender) || !string.IsNullOrEmpty(Model.SelectedCivilStatus) ||
                   !string.IsNullOrEmpty(Model.SelectedAgeRange) || !string.IsNullOrEmpty(Model.SelectedBirthDate) ||
                   !string.IsNullOrEmpty(Model.SelectedPensionType))
                {
                    <div class="mt-3">
                        <span class="badge badge-info">Showing @Model.SeniorList.Count senior records</span>
                        @if (!string.IsNullOrEmpty(Model.SelectedStatus))
                        {
                            <span class="badge badge-secondary ml-2">Status: @Model.SelectedStatus</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedZoneFilter))
                        {
                            <span class="badge badge-secondary ml-2">Zone: @Model.SelectedZoneFilter</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedGender))
                        {
                            <span class="badge badge-secondary ml-2">Gender: @Model.SelectedGender</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedPensionType))
                        {
                            <span class="badge badge-secondary ml-2">Pension: @Model.SelectedPensionType</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedAgeRange))
                        {
                            <span class="badge badge-secondary ml-2">Age: @Model.SelectedAgeRange</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedBirthDate))
                        {
                            <span class="badge badge-secondary ml-2">Birth Date: @DateTime.Parse(Model.SelectedBirthDate).ToString("MMM dd, yyyy")</span>
                        }
                    </div>
                }
            </div>

            <!-- Senior Table -->
            <div class="table-responsive">
                <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>OSCA Number</th>
                            <th>Full Name</th>
                            <th>Sex</th>
                            <th>Age</th>
                            <th>Birth Date</th>
                            <th>Zone</th>
                            <th>Civil Status</th>
                            <th>Pension Type</th>
                            <th>Contact Number</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.SeniorList.Any())
                        {
                            foreach (var senior in Model.SeniorList)
                            {
                                <tr>
                                    <td>
                                        <span class="badge badge-info">@senior.FormattedSCCN</span>
                                    </td>
                                    <td>@senior.CompleteName</td>
                                    <td>@senior.Gender</td>
                                    <td>@senior.Age</td>
                                    <td>@(senior.BirthDate?.ToString("MMM dd, yyyy") ?? "N/A")</td>
                                    <td>Zone @senior.Zone</td>
                                    <td>
                                        @if (string.IsNullOrEmpty(senior.CivilStatus))
                                        {
                                            <span class="text-muted">Not specified</span>
                                        }
                                        else
                                        {
                                            @senior.CivilStatus
                                        }
                                    </td>
                                    <td>
                                        @if (string.IsNullOrEmpty(senior.PensionType))
                                        {
                                            <span class="badge bg-warning">NoPension</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-info">@senior.PensionType</span>
                                        }
                                    </td>
                                    <td>
                                        @if (string.IsNullOrEmpty(senior.ContactNumber))
                                        {
                                            <span class="text-muted">N/A</span>
                                        }
                                        else
                                        {
                                            @senior.ContactNumber
                                        }
                                    </td>
                                    <td>
                                        <span class="badge @(senior.Status == "Active" ? "badge-success" : "badge-warning")">
                                            @senior.Status
                                        </span>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="10" class="text-center py-3">
                                    <i class="fas fa-search fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">No senior records found</p>
                                    @if (hasSeniorFilters)
                                    {
                                        <a href="@Url.Action("Index", "Report", new {
                                            eventStatus = Model.SelectedEventStatus,
                                            eventType = Model.SelectedEventType,
                                            eventDateFilter = Model.SelectedEventDateFilter,
                                            eventSearch = Model.EventSearchTerm,
                                            fromDate = Model.SelectedFromDate,
                                            toDate = Model.SelectedToDate
                                        })" class="btn btn-sm btn-outline-primary mt-2">
                                            <i class="fas fa-times me-1"></i> Clear Senior Filters
                                        </a>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <span class="small text-muted">
                    Total Records: @Model.SeniorList.Count
                </span>
                <div class="btn-group">
                    @if (Model.SeniorList.Any())
                    {
                        <a href="@Url.Action("ExportSeniorTable", "Report", new {
                            status = Model.SelectedStatus,
                            zone = Model.SelectedZoneFilter,
                            gender = Model.SelectedGender,
                            civilStatus = Model.SelectedCivilStatus,
                            ageRange = Model.SelectedAgeRange,
                            birthDate = Model.SelectedBirthDate,
                            seniorSearch = Model.SeniorSearchTerm,
                            pensionType = Model.SelectedPensionType
                        })" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-file-export me-1"></i> Export Basic
                        </a>
                        <a href="@Url.Action("ExportSeniorDetailed", "Report", new {
                            status = Model.SelectedStatus,
                            zone = Model.SelectedZoneFilter,
                            gender = Model.SelectedGender,
                            civilStatus = Model.SelectedCivilStatus,
                            ageRange = Model.SelectedAgeRange,
                            birthDate = Model.SelectedBirthDate,
                            seniorSearch = Model.SeniorSearchTerm,
                            pensionType = Model.SelectedPensionType
                        })" class="btn btn-sm btn-outline-success">
                            <i class="fas fa-file-alt me-1"></i> Export Detailed
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Events Report Section -->
    <div class="card shadow">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-calendar-alt me-2"></i>Events Report
            </h6>
            <span class="badge bg-info">@Model.TotalEvents Events</span>
        </div>
        <div class="card-body">
            <!-- Event Filter Section -->
            <div class="mb-4">
                <form method="get" class="row g-3">
                    <input type="hidden" name="status" value="@Model.SelectedStatus" />
                    <input type="hidden" name="zone" value="@Model.SelectedZoneFilter" />
                    <input type="hidden" name="gender" value="@Model.SelectedGender" />
                    <input type="hidden" name="civilStatus" value="@Model.SelectedCivilStatus" />
                    <input type="hidden" name="ageRange" value="@Model.SelectedAgeRange" />
                    <input type="hidden" name="birthDate" value="@Model.SelectedBirthDate" />
                    <input type="hidden" name="seniorSearch" value="@Model.SeniorSearchTerm" />
                    <input type="hidden" name="pensionType" value="@Model.SelectedPensionType" />

                    <!-- Event Status Filter -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">Event Status</label>
                        <select class="form-control form-control-sm" name="eventStatus">
                            <option value="">All Status</option>
                            <option value="Scheduled" selected="@(Model.SelectedEventStatus == "Scheduled")">Scheduled</option>
                            <option value="Ongoing" selected="@(Model.SelectedEventStatus == "Ongoing")">Ongoing</option>
                            <option value="Completed" selected="@(Model.SelectedEventStatus == "Completed")">Completed</option>
                            <option value="Cancelled" selected="@(Model.SelectedEventStatus == "Cancelled")">Cancelled</option>
                        </select>
                    </div>

                    <!-- Event Type Filter -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">Event Type</label>
                        <select class="form-control form-control-sm" name="eventType">
                            <option value="">All Types</option>
                            <option value="Medical Mission" selected="@(Model.SelectedEventType == "Medical Mission")">Medical Mission</option>
                            <option value="Assistance Program" selected="@(Model.SelectedEventType == "Assistance Program")">Assistance Program</option>
                            <option value="Wellness Activity" selected="@(Model.SelectedEventType == "Wellness Activity")">Wellness Activity</option>
                            <option value="Community Gathering" selected="@(Model.SelectedEventType == "Community Gathering")">Community Gathering</option>
                            <option value="Educational" selected="@(Model.SelectedEventType == "Educational")">Educational</option>
                            <option value="Social" selected="@(Model.SelectedEventType == "Social")">Social</option>
                        </select>
                    </div>

                    <!-- Event Date Filter -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">Date Filter</label>
                        <select class="form-control form-control-sm" name="eventDateFilter">
                            <option value="">All Dates</option>
                            <option value="today" selected="@(Model.SelectedEventDateFilter == "today")">Today</option>
                            <option value="tomorrow" selected="@(Model.SelectedEventDateFilter == "tomorrow")">Tomorrow</option>
                            <option value="thisweek" selected="@(Model.SelectedEventDateFilter == "thisweek")">This Week</option>
                            <option value="nextweek" selected="@(Model.SelectedEventDateFilter == "nextweek")">Next Week</option>
                            <option value="thismonth" selected="@(Model.SelectedEventDateFilter == "thismonth")">This Month</option>
                            <option value="nextmonth" selected="@(Model.SelectedEventDateFilter == "nextmonth")">Next Month</option>
                            <option value="past" selected="@(Model.SelectedEventDateFilter == "past")">Past Events</option>
                            <option value="upcoming" selected="@(Model.SelectedEventDateFilter == "upcoming")">Upcoming</option>
                        </select>
                    </div>

                    <!-- Date Range -->
                    <div class="col-md-3">
                        <label class="small font-weight-bold">From Date</label>
                        <input type="date" class="form-control form-control-sm" name="fromDate" value="@Model.SelectedFromDate" />
                    </div>
                    <div class="col-md-3">
                        <label class="small font-weight-bold">To Date</label>
                        <input type="date" class="form-control form-control-sm" name="toDate" value="@Model.SelectedToDate" />
                    </div>

                    <!-- Event Search -->
                    <div class="col-md-5">
                        <label class="small font-weight-bold">Search Events</label>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" name="eventSearch"
                                   value="@Model.EventSearchTerm" placeholder="Search by title, location, or organizer...">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Buttons -->
                    <div class="col-md-4 d-flex align-items-end">
                        <button type="submit" class="btn btn-sm btn-primary mr-2">
                            <i class="fas fa-filter me-1"></i> Apply Filters
                        </button>
                        @if (hasEventFilters)
                        {
                            <a href="@Url.Action("Index", "Report", new {
                                status = Model.SelectedStatus,
                                zone = Model.SelectedZoneFilter,
                                gender = Model.SelectedGender,
                                civilStatus = Model.SelectedCivilStatus,
                                ageRange = Model.SelectedAgeRange,
                                birthDate = Model.SelectedBirthDate,
                                seniorSearch = Model.SeniorSearchTerm,
                                pensionType = Model.SelectedPensionType
                            })" class="btn btn-sm btn-secondary">
                                <i class="fas fa-times me-1"></i> Clear Event Filters
                            </a>
                        }
                    </div>
                </form>

                <!-- Results Summary -->
                @if (!string.IsNullOrEmpty(Model.SelectedEventStatus) || !string.IsNullOrEmpty(Model.SelectedEventType) || 
                   !string.IsNullOrEmpty(Model.SelectedEventDateFilter) || !string.IsNullOrEmpty(Model.SelectedFromDate) ||
                   !string.IsNullOrEmpty(Model.SelectedToDate))
                {
                    <div class="mt-3">
                        <span class="badge badge-info">Showing @Model.EventList.Count event records</span>
                        @if (!string.IsNullOrEmpty(Model.SelectedEventStatus))
                        {
                            <span class="badge badge-secondary ml-2">Status: @Model.SelectedEventStatus</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedEventType))
                        {
                            <span class="badge badge-secondary ml-2">Type: @Model.SelectedEventType</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedFromDate))
                        {
                            <span class="badge badge-secondary ml-2">From: @Model.SelectedFromDate</span>
                        }
                        @if (!string.IsNullOrEmpty(Model.SelectedToDate))
                        {
                            <span class="badge badge-secondary ml-2">To: @Model.SelectedToDate</span>
                        }
                    </div>
                }
            </div>

            <!-- Events Table with Attendance -->
            <div class="table-responsive">
                <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                    <thead class="thead-dark">
                        <tr>
                            <th>Event Title</th>
                            <th>Type</th>
                            <th>Date & Time</th>
                            <th>Location</th>
                            <th>Organized By</th>
                            <th>Max Capacity</th>
                            <th>Attendance</th>
                            <th>Attendance %</th>
                            <th>Available Slots</th>
                            <th>Status</th>
                            <th>Created On</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.EventList.Any())
                        {
                            foreach (var eventItem in Model.EventList)
                            {
                                <tr>
                                    <td>@eventItem.EventTitle</td>
                                    <td>
                                        <span class="badge bg-info">@eventItem.EventType</span>
                                    </td>
                                    <td>@eventItem.EventDateTime</td>
                                    <td>@eventItem.EventLocation</td>
                                    <td>@eventItem.OrganizedBy</td>
                                    <td>
                                        @if (eventItem.MaxCapacity.HasValue)
                                        {
                                            <span>@eventItem.MaxCapacity</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">No Limit</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="@(eventItem.IsFull ? "text-danger font-weight-bold" : "")">@eventItem.AttendanceCount</span>
                                    </td>
                                    <td>
                                        <span class="badge @GetAttendanceBadgeClass(eventItem.AttendancePercentage)">
                                            @eventItem.AttendancePercentage
                                        </span>
                                    </td>
                                    <td>
                                        @if (eventItem.AvailableSlots == -1)
                                        {
                                            <span class="text-muted">Unlimited</span>
                                        }
                                        else if (eventItem.AvailableSlots == 0)
                                        {
                                            <span class="text-danger font-weight-bold">FULL</span>
                                        }
                                        else
                                        {
                                            <span class="text-success">@eventItem.AvailableSlots</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge @GetEventStatusBadgeClass(eventItem.Status)">
                                            @eventItem.Status
                                        </span>
                                    </td>
                                    <td>@eventItem.CreatedAt.ToString("MMM dd, yyyy")</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="11" class="text-center py-3">
                                    <i class="fas fa-calendar-times fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">No event records found</p>
                                    @if (hasEventFilters)
                                    {
                                        <a href="@Url.Action("Index", "Report", new {
                                            status = Model.SelectedStatus,
                                            zone = Model.SelectedZoneFilter,
                                            gender = Model.SelectedGender,
                                            civilStatus = Model.SelectedCivilStatus,
                                            ageRange = Model.SelectedAgeRange,
                                            birthDate = Model.SelectedBirthDate,
                                            seniorSearch = Model.SeniorSearchTerm,
                                            pensionType = Model.SelectedPensionType
                                        })" class="btn btn-sm btn-outline-primary mt-2">
                                            <i class="fas fa-times me-1"></i> Clear Event Filters
                                        </a>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <span class="small text-muted">
                    Total Records: @Model.EventList.Count
                </span>
                @if (Model.EventList.Any())
                {
                    <a href="@Url.Action("ExportEventTable", "Report", new {
                        eventStatus = Model.SelectedEventStatus,
                        eventType = Model.SelectedEventType,
                        eventDateFilter = Model.SelectedEventDateFilter,
                        eventSearch = Model.EventSearchTerm,
                        fromDate = Model.SelectedFromDate,
                        toDate = Model.SelectedToDate
                    })" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-download me-1"></i> Export Event Table Data
                    </a>
                }
            </div>
        </div>
    </div>
</div>

@functions {
    string GetEventStatusBadgeClass(string status)
    {
        switch (status)
        {
            case "Scheduled":
                return "badge-primary";
            case "Ongoing":
                return "badge-warning";
            case "Completed":
                return "badge-success";
            case "Cancelled":
                return "badge-danger";
            default:
                return "badge-secondary";
        }
    }

    string GetAttendanceBadgeClass(string percentage)
    {
        if (percentage == "N/A" || percentage == "No Limit")
            return "badge-secondary";
        
        if (percentage.Contains("100%"))
            return "badge-danger";
        
        if (percentage.Contains("90") || percentage.Contains("80"))
            return "badge-warning";
        
        if (percentage.Contains("70") || percentage.Contains("60"))
            return "badge-info";
        
        return "badge-success";
    }
}

@section Styles {
    <style>
        .badge-primary { background-color: #007bff; }
        .badge-success { background-color: #28a745; }
        .badge-warning { background-color: #ffc107; color: #212529; }
        .badge-danger { background-color: #dc3545; }
        .badge-info { background-color: #17a2b8; }
        .badge-secondary { background-color: #6c757d; }
        
        .table th {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .table td {
            vertical-align: middle;
        }
        
        .card {
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: #f8f9fa;
        }
        
        .btn-group .btn {
            margin-right: 5px;
        }
        
        /* Datepicker styles */
        .datepicker-dropdown {
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .datepicker table tr td.active.active {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .datepicker table tr td.today {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #212529;
        }
        
        .input-group-text {
            padding: 0.375rem 0.75rem;
        }
    </style>
}

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    
    <script>
        // Initialize datepicker for birth date
        $(document).ready(function() {
            $('#birthDatePicker').datepicker({
                format: 'yyyy-mm-dd',
                autoclose: true,
                todayHighlight: true,
                endDate: '1965-12-31', // Only dates up to 1965
                startDate: '1900-01-01', // Start from 1900
                clearBtn: true
            });
        });

        function loadStaticZones() {
    const zoneFilter = document.getElementById('zoneFilter');
    // Add basic zone options as fallback
    // Just show "Zone 1", "Zone 2", etc.
    for (let i = 1; i <= 8; i++) {
        const option = document.createElement('option');
        option.value = i.toString();
        option.textContent = `Zone ${i}`;
        zoneFilter.appendChild(option);
    }
}

        // Function to update age range hidden field
        function updateAgeRange() {
            var minAge = $('#minAge').val();
            var maxAge = $('#maxAge').val();
            var ageRange = '';
            
            // Validate min and max
            if (minAge && maxAge) {
                var min = parseInt(minAge);
                var max = parseInt(maxAge);
                
                if (min > max) {
                    // Swap values if min is greater than max
                    $('#minAge').val(max);
                    $('#maxAge').val(min);
                    minAge = max.toString();
                    maxAge = min.toString();
                    min = parseInt(minAge);
                    max = parseInt(maxAge);
                }
                
                // Validate range
                if (min >= 60 && max <= 120) {
                    ageRange = minAge + '-' + maxAge;
                } else if (min >= 60 && max > 120) {
                    ageRange = minAge + '-120';
                    $('#maxAge').val('120');
                }
            } else if (minAge && !maxAge) {
                // If only min age is provided, set to 90+ format
                if (parseInt(minAge) >= 90) {
                    ageRange = minAge + '+';
                }
            }
            
            $('#ageRange').val(ageRange);
        }

        // Function to clear birth date
        function clearBirthDate() {
            $('#birthDatePicker').val('');
            $('#birthDatePicker').datepicker('update', '');
        }

        // Auto-submit form when filter changes (except search fields)
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', function() {
                // Don't auto-submit if it's a search-related field
                if (!this.name.includes('Search')) {
                    this.form.submit();
                }
            });
        });

        // Auto-submit date range changes
        document.querySelectorAll('input[type="date"]').forEach(input => {
            input.addEventListener('change', function() {
                if (this.value) {
                    this.form.submit();
                }
            });
        });

        // Auto-submit when birth date is selected
        $('#birthDatePicker').on('changeDate', function(e) {
            if (e.date) {
                $('#seniorFilterForm').submit();
            }
        });

        // Keyboard shortcut for search focus
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('input[name="seniorSearch"]');
                if (searchInput) searchInput.focus();
            }
        });

        // Validate age inputs on blur
        $('#minAge, #maxAge').on('blur', function() {
            var value = $(this).val();
            if (value) {
                var numValue = parseInt(value);
                if (numValue < 60) {
                    $(this).val('60');
                } else if (numValue > 120) {
                    $(this).val('120');
                }
                updateAgeRange();
            }
        });
    </script>
}