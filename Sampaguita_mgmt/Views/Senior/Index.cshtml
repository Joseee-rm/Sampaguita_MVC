@model List<SeniorManagement.Models.Senior>

@{
    ViewData["Title"] = "";
}

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h3><i class="fas fa-user-friends me-2"></i>Senior Records</h3>
        <div class="d-flex gap-2">
            <a href="@Url.Action("ArchivedSeniors", "Senior")" class="btn btn-archived">
                <i class="fas fa-archive me-1"></i> View Archived Records
            </a>
            <a asp-action="CreateSenior" class="btn btn-create-new">
                <i class="fas fa-plus-circle me-1"></i>
                <span>Create New Senior</span>
                <span class="count-badge">+</span>
            </a>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="card-body border-bottom">
        <div class="row g-3">
            <div class="col-md-6 col-lg-4">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text"
                           class="form-control search-input"
                           id="searchInput"
                           placeholder="Search by name, SCCN, zone..."
                           aria-label="Search">
                    <button class="btn btn-clear-search" id="clearSearch" type="button" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="col-md-3 col-lg-2">
                <select class="form-select filter-select" id="genderFilter">
                    <option value="">All Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
            <div class="col-md-3 col-lg-2">
                <select class="form-select filter-select" id="zoneFilter">
                    <option value="">All Zones</option>
                    <option value="1">Zone 1</option>
                    <option value="2">Zone 2</option>
                    <option value="3">Zone 3</option>
                    <option value="4">Zone 4</option>
                    <option value="5">Zone 5</option>
                    <option value="6">Zone 6</option>
                    <option value="7">Zone 7</option>
                </select>
            </div>
            <div class="col-md-6 col-lg-4">
                <div class="d-flex gap-2">
                    <button class="btn btn-filter" id="applyFilters">
                        <i class="fas fa-filter me-1"></i> Apply Filters
                    </button>
                    <button class="btn btn-outline-secondary" id="resetFilters">
                        <i class="fas fa-redo me-1"></i> Reset
                    </button>
                    <button class="btn btn-outline-info" id="toggleFilters" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                        <i class="fas fa-sliders-h me-1"></i> Advanced
                    </button>
                </div>
            </div>
        </div>

        <!-- Advanced Filters (Collapsed by Default) -->
        <div class="collapse mt-3" id="advancedFilters">
            <div class="card card-body bg-light">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Age Range</label>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control" id="minAge" placeholder="Min" min="60" max="120">
                            <span class="mx-2">to</span>
                            <input type="number" class="form-control" id="maxAge" placeholder="Max" min="60" max="120">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Sort By</label>
                        <select class="form-select" id="sortBy">
                            <option value="name">Name (A-Z)</option>
                            <option value="name_desc">Name (Z-A)</option>
                            <option value="age">Age (Low to High)</option>
                            <option value="age_desc">Age (High to Low)</option>
                            <option value="zone">Zone (1-7)</option>
                            <option value="zone_desc">Zone (7-1)</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Records Per Page</label>
                        <select class="form-select" id="pageSize">
                            <option value="10">10 records</option>
                            <option value="25" selected>25 records</option>
                            <option value="50">50 records</option>
                            <option value="100">100 records</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters mt-3" id="activeFilters" style="display: none;">
            <div class="d-flex align-items-center">
                <span class="me-2 text-muted">Active Filters:</span>
                <div class="d-flex flex-wrap gap-2" id="filterTags"></div>
            </div>
        </div>
    </div>

    <!-- Main Table Content -->
    <div class="card-body">
        <!-- Results Count -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                <span id="resultsCount" class="text-muted">
                    Showing @Model.Count of @Model.Count records
                </span>
            </div>
            <div class="d-flex align-items-center gap-2">
                <!-- Removed Export and Print buttons -->
                <button type="button" class="btn btn-sm btn-outline-secondary" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        @if (Model.Any())
        {
            <div class="table-responsive" id="seniorTable">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th class="sortable" data-sort="sccn">
                                SCCN Number <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-sort="name">
                                Full Name <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-sort="age">
                                Age <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-sort="gender">
                                Gender <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable" data-sort="zone">
                                Zone <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th>Contact</th>
                            <th>Barangay</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="seniorTableBody">
                        @foreach (var senior in Model)
                        {
                            <tr class="senior-row"
                                data-name="@senior.CompleteName.ToLower()"
                                data-sccn="@senior.SeniorId"
                                data-age="@senior.Age"
                                data-gender="@senior.Gender"
                                data-zone="@senior.Zone"
                                data-status="@senior.Status">
                                <td>
                                    <span class="badge sccn-badge">@senior.FormattedSCCN</span>
                                </td>
                                <td>@senior.CompleteName</td>
                                <td>
                                    <span class="age-badge">@senior.Age</span>
                                </td>
                                <td>
                                    <span class="badge @(senior.Gender == "Male" ? "badge-male" : "badge-female")">
                                        @senior.Gender
                                    </span>
                                </td>
                                <td>
                                    <span class="zone-badge">Zone @senior.Zone</span>
                                </td>
                                <td>
                                    @if (!string.IsNullOrEmpty(senior.ContactNumber))
                                    {
                                        <span class="contact-info">
                                            <i class="fas fa-phone-alt me-1"></i>@senior.ContactNumber
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">N/A</span>
                                    }
                                </td>
                                <td>@senior.Barangay</td>
                                <td>
                                    <span class="status-badge @(senior.Status == "Active" ? "badge-active" : "badge-inactive")">
                                        @senior.Status
                                    </span>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="@Url.Action("ViewSenior", "Senior", new { id = senior.Id })"
                                           class="btn-action btn-view" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="@Url.Action("EditSenior", "Senior", new { id = senior.Id })"
                                           class="btn-action btn-edit" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form asp-action="ArchiveSenior" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@senior.Id" />
                                            <button type="submit"
                                                    class="btn-action btn-archive"
                                                    title="Archive"
                                                    onclick="return confirmArchive('@senior.CompleteName')">
                                                <i class="fas fa-archive"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <!-- No Results Message (Hidden by Default) -->
            <div id="noResults" class="text-center py-5" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-search"></i>
                </div>
                <h4 class="text-muted mt-3">No Records Found</h4>
                <p class="text-muted">Try adjusting your search or filters</p>
                <button class="btn btn-outline-primary mt-2" id="clearAllFilters">
                    <i class="fas fa-redo me-1"></i> Clear All Filters
                </button>
            </div>

            <!-- Pagination -->
            <nav aria-label="Page navigation" id="paginationContainer" style="display: none;">
                <ul class="pagination justify-content-center mt-4">
                    <li class="page-item disabled" id="prevPage">
                        <a class="page-link" href="#" tabindex="-1">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item" id="nextPage">
                        <a class="page-link" href="#">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        }
        else
        {
            <div class="text-center py-5 empty-state">
                <div class="empty-icon">
                    <i class="fas fa-user-friends"></i>
                </div>
                <h4 class="text-muted mt-3">No Senior Records Found</h4>
                <p class="text-muted">There are no active senior records in the system yet.</p>
                <a asp-action="CreateSenior" class="btn btn-create-new mt-3">
                    <i class="fas fa-plus-circle me-2"></i> Create First Senior Record
                </a>
            </div>
        }
    </div>
</div>

<!-- Zone Distribution - FIXED VERSION -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-map-marked-alt me-2"></i>Zone Distribution</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    @{
                        var zonesWithData = Model.Where(s => s.Zone >= 1 && s.Zone <= 7)
                        .GroupBy(s => s.Zone)
                        .Select(g => new { Zone = g.Key, Count = g.Count() })
                        .OrderBy(z => z.Zone)
                        .ToList();

                        // If no zones have data, show message
                        if (!zonesWithData.Any())
                        {
                            <div class="col-12 text-center py-3">
                                <p class="text-muted mb-0">No zone data available</p>
                            </div>
                        }
                        else
                        {
                            @foreach (var zoneData in zonesWithData)
                            {
                                <div class="col-md-4 col-lg-3 mb-3">
                                    <div class="zone-distribution-card">
                                        <div class="zone-number">Zone @zoneData.Zone</div>
                                        <div class="zone-count">@zoneData.Count</div>
                                        <div class="zone-progress">
                                            <div class="zone-progress-bar"
                                                 style="width: @(Model.Count > 0 ? (zoneData.Count * 100 / Model.Count) : 0)%">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        </div>

@section Styles {
            <style>
                /* Main Card Styles */
                .card {
                    border: none;
                    box-shadow: 0 0.15rem 1.75rem 0 rgba(33, 150, 243, 0.1);
                    border-radius: 0.5rem;
                    overflow: hidden;
                    border-left: 4px solid #2196f3;
                }

                .card-header {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    color: white;
                    border-bottom: none;
                    padding: 1.25rem 1.5rem;
                }

                    .card-header h3 {
                        margin: 0;
                        font-weight: 600;
                    }

                /* Search Box */
                .search-box {
                    position: relative;
                }

                .search-icon {
                    position: absolute;
                    left: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #6c757d;
                    z-index: 3;
                }

                .search-input {
                    padding-left: 40px;
                    padding-right: 40px;
                    border: 2px solid #e3f2fd;
                    border-radius: 0.5rem;
                    transition: all 0.3s ease;
                }

                    .search-input:focus {
                        border-color: #2196f3;
                        box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
                    }

                .btn-clear-search {
                    position: absolute;
                    right: 8px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    color: #6c757d;
                    padding: 4px 8px;
                    z-index: 3;
                }

                    .btn-clear-search:hover {
                        color: #f44336;
                    }

                /* Filter Styles */
                .filter-select {
                    border: 2px solid #e3f2fd;
                    border-radius: 0.5rem;
                    transition: all 0.3s ease;
                }

                    .filter-select:focus {
                        border-color: #2196f3;
                        box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
                    }

                .btn-filter {
                    background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
                    border: none;
                    color: white;
                    padding: 0.5rem 1.5rem;
                    border-radius: 0.5rem;
                    font-weight: 600;
                }

                    .btn-filter:hover {
                        background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
                    }

                /* Active Filters */
                .active-filters {
                    background: #f8fbff;
                    border: 1px solid #e3f2fd;
                    border-radius: 0.5rem;
                    padding: 1rem;
                }

                .filter-tag {
                    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
                    border: 1px solid #90caf9;
                    border-radius: 1rem;
                    padding: 0.25rem 0.75rem;
                    font-size: 0.875rem;
                    color: #1565c0;
                    display: inline-flex;
                    align-items: center;
                    gap: 0.25rem;
                }

                    .filter-tag .remove-filter {
                        background: none;
                        border: none;
                        color: #f44336;
                        padding: 0;
                        font-size: 0.75rem;
                        cursor: pointer;
                    }

                /* Sortable Headers */
                .sortable {
                    cursor: pointer;
                    user-select: none;
                }

                    .sortable:hover {
                        background-color: rgba(33, 150, 243, 0.1);
                    }

                .sort-asc .fa-sort::before {
                    content: "\f0de";
                }

                .sort-desc .fa-sort::before {
                    content: "\f0dd";
                }

                /* Button Styles */
                .btn-create-new {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    border: none;
                    color: white;
                    padding: 0.625rem 1.5rem;
                    border-radius: 0.375rem;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.3s ease;
                    text-decoration: none;
                    box-shadow: 0 4px 15px 0 rgba(33, 150, 243, 0.3);
                }

                    .btn-create-new:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px 0 rgba(33, 150, 243, 0.4);
                        color: white;
                        background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
                    }

                    .btn-create-new .count-badge {
                        background: white;
                        color: #2196f3;
                        width: 22px;
                        height: 22px;
                        border-radius: 50%;
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 12px;
                        font-weight: bold;
                        margin-left: 0.25rem;
                    }

                .btn-archived {
                    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
                    border: none;
                    color: white;
                    padding: 0.625rem 1.5rem;
                    border-radius: 0.375rem;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    transition: all 0.3s ease;
                    text-decoration: none;
                    box-shadow: 0 4px 15px 0 rgba(255, 152, 0, 0.3);
                }

                    .btn-archived:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px 0 rgba(255, 152, 0, 0.4);
                        color: white;
                        background: linear-gradient(135deg, #f57c00 0%, #ef6c00 100%);
                    }

                /* Action Buttons */
                .action-buttons {
                    display: flex;
                    gap: 0.375rem;
                }

                .btn-action {
                    width: 32px;
                    height: 32px;
                    border-radius: 0.25rem;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    border: none;
                    color: white;
                    transition: all 0.2s ease;
                    cursor: pointer;
                    text-decoration: none;
                }

                    .btn-action:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 3px 8px rgba(33, 150, 243, 0.3);
                    }

                .btn-view {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                }

                    .btn-view:hover {
                        background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
                    }

                .btn-edit {
                    background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
                }

                    .btn-edit:hover {
                        background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
                    }

                .btn-archive {
                    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
                }

                    .btn-archive:hover {
                        background: linear-gradient(135deg, #f57c00 0%, #ef6c00 100%);
                    }

                /* Table Styles */
                .table {
                    margin-bottom: 0;
                }

                    .table th {
                        font-weight: 600;
                        text-transform: uppercase;
                        font-size: 0.75rem;
                        letter-spacing: 0.5px;
                        background: linear-gradient(135deg, #1976d2 0%, #0d47a1 100%);
                        color: white;
                        padding: 1rem;
                        border: none;
                    }

                    .table td {
                        padding: 1rem;
                        vertical-align: middle;
                        border-bottom: 1px solid #e3f2fd;
                    }

                .table-striped tbody tr:nth-of-type(odd) {
                    background-color: #f8fbff;
                }

                .table-hover tbody tr:hover {
                    background-color: #e3f2fd;
                    transform: translateX(2px);
                    transition: all 0.2s ease;
                }

                /* Badge Styles */
                .badge {
                    font-weight: 600;
                    padding: 0.375rem 0.75rem;
                    border-radius: 0.25rem;
                    font-size: 0.75rem;
                    border: none;
                }

                .sccn-badge {
                    background: linear-gradient(135deg, #bbdefb 0%, #e3f2fd 100%);
                    color: #1565c0;
                    border: 1px solid #bbdefb;
                }

                .age-badge {
                    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
                    color: #2e7d32;
                    padding: 0.25rem 0.75rem;
                    border-radius: 1rem;
                    font-weight: 600;
                    font-size: 0.875rem;
                    border: 1px solid #c8e6c9;
                }

                .badge-male {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    color: white;
                }

                .badge-female {
                    background: linear-gradient(135deg, #f06292 0%, #ec407a 100%);
                    color: white;
                }

                .zone-badge {
                    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
                    color: #1565c0;
                    padding: 0.25rem 0.75rem;
                    border-radius: 1rem;
                    font-weight: 600;
                    border: 1px solid #bbdefb;
                }

                .status-badge {
                    padding: 0.375rem 0.875rem;
                    border-radius: 0.25rem;
                    font-weight: 600;
                    font-size: 0.75rem;
                }

                .badge-active {
                    background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
                    color: white;
                }

                .badge-inactive {
                    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
                    color: white;
                }

                .contact-info {
                    display: flex;
                    align-items: center;
                    gap: 0.375rem;
                    color: #1976d2;
                }

                    .contact-info i {
                        color: #2196f3;
                    }

                /* Empty State */
                .empty-state {
                    padding: 4rem 2rem;
                }

                .empty-icon {
                    font-size: 4rem;
                    color: #bbdefb;
                    margin-bottom: 1rem;
                }

                /* Stat Cards */
                .stat-card {
                    border-radius: 0.5rem;
                    padding: 1.5rem;
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    box-shadow: 0 0.15rem 1.75rem 0 rgba(33, 150, 243, 0.1);
                    transition: transform 0.3s ease;
                    height: 100%;
                    border: 1px solid #e3f2fd;
                }

                    .stat-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 0.5rem 2rem 0 rgba(33, 150, 243, 0.2);
                    }

                .card-total {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    color: white;
                    border: none;
                }

                .card-active {
                    background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
                    color: white;
                    border: none;
                }

                .card-male {
                    background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%);
                    color: white;
                    border: none;
                }

                .card-female {
                    background: linear-gradient(135deg, #f06292 0%, #d81b60 100%);
                    color: white;
                    border: none;
                }

                .stat-icon {
                    font-size: 2.5rem;
                    opacity: 0.9;
                }

                .stat-content h3 {
                    margin: 0;
                    font-size: 1.75rem;
                    font-weight: 700;
                }

                .stat-content p {
                    margin: 0.25rem 0 0 0;
                    opacity: 0.9;
                    font-size: 0.875rem;
                }

                /* Zone Distribution */
                .zone-distribution-card {
                    background: white;
                    border: 2px solid #e3f2fd;
                    border-radius: 0.5rem;
                    padding: 1rem;
                    transition: all 0.3s ease;
                }

                    .zone-distribution-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);
                        border-color: #2196f3;
                    }

                .zone-number {
                    font-weight: 600;
                    color: #1976d2;
                    margin-bottom: 0.5rem;
                    font-size: 1rem;
                }

                .zone-count {
                    font-size: 1.5rem;
                    font-weight: 700;
                    color: #2196f3;
                    margin-bottom: 0.5rem;
                }

                .zone-progress {
                    height: 6px;
                    background: #e3f2fd;
                    border-radius: 3px;
                    overflow: hidden;
                }

                .zone-progress-bar {
                    height: 100%;
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    border-radius: 3px;
                    transition: width 0.3s ease;
                }

                /* Pagination */
                .pagination .page-link {
                    color: #2196f3;
                    border: 1px solid #e3f2fd;
                }

                    .pagination .page-link:hover {
                        background-color: #e3f2fd;
                        border-color: #2196f3;
                    }

                .pagination .page-item.active .page-link {
                    background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
                    border-color: #2196f3;
                }

                /* Responsive */
                @@media (max-width: 768px) {
                    .search-box, .filter-select {
                        margin-bottom: 0.5rem;
                    }

                    .btn-filter, .btn-outline-secondary, .btn-outline-info {
                        width: 100%;
                        margin-bottom: 0.5rem;
                    }

                    .active-filters .filter-tag {
                        font-size: 0.75rem;
                        padding: 0.2rem 0.5rem;
                    }
                }
            </style>
}

@section Scripts {
            <script>
                function confirmArchive(seniorName) {
                    return confirm(`Are you sure you want to archive ${seniorName}? This will move the record to archived records.`);
                }

                document.addEventListener('DOMContentLoaded', function() {
                    // Archive button loading state
                    const archiveForms = document.querySelectorAll('form[action*="ArchiveSenior"]');
                    archiveForms.forEach(form => {
                        form.addEventListener('submit', function(e) {
                            const btn = this.querySelector('button[type="submit"]');
                            btn.classList.add('btn-loading');
                            btn.disabled = true;
                            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        });
                    });

                    // ============ SEARCH AND FILTER FUNCTIONALITY ============
                    let currentFilters = {
                        search: '',
                        gender: '',
                        zone: '',
                        minAge: null,
                        maxAge: null,
                        status: '',
                        sortBy: 'name',
                        pageSize: 25,
                        currentPage: 1
                    };

                    // Get all senior rows
                    const seniorRows = document.querySelectorAll('.senior-row');
                    const totalRecords = seniorRows.length;

                    // Initialize
                    updateResultsCount();
                    setupEventListeners();
                    applyFilters(); // Show all initially

                    function setupEventListeners() {
                        // Search input
                        const searchInput = document.getElementById('searchInput');
                        const clearSearchBtn = document.getElementById('clearSearch');

                        searchInput.addEventListener('input', function() {
                            currentFilters.search = this.value.toLowerCase();
                            if (this.value) {
                                clearSearchBtn.style.display = 'block';
                            } else {
                                clearSearchBtn.style.display = 'none';
                            }
                            applyFilters();
                        });

                        clearSearchBtn.addEventListener('click', function() {
                            searchInput.value = '';
                            currentFilters.search = '';
                            this.style.display = 'none';
                            applyFilters();
                        });

                        // Basic filters
                        document.getElementById('genderFilter').addEventListener('change', function() {
                            currentFilters.gender = this.value;
                            applyFilters();
                        });

                        document.getElementById('zoneFilter').addEventListener('change', function() {
                            currentFilters.zone = this.value;
                            applyFilters();
                        });

                        // Apply filters button
                        document.getElementById('applyFilters').addEventListener('click', function() {
                            // Get advanced filter values
                            currentFilters.minAge = document.getElementById('minAge').value || null;
                            currentFilters.maxAge = document.getElementById('maxAge').value || null;
                            currentFilters.status = document.getElementById('statusFilter').value;
                            currentFilters.sortBy = document.getElementById('sortBy').value;
                            currentFilters.pageSize = parseInt(document.getElementById('pageSize').value);

                            applyFilters();
                        });

                        // Reset filters
                        document.getElementById('resetFilters').addEventListener('click', resetFilters);
                        document.getElementById('clearAllFilters').addEventListener('click', resetFilters);

                        // Sortable headers
                        document.querySelectorAll('.sortable').forEach(header => {
                            header.addEventListener('click', function() {
                                const sortField = this.dataset.sort;
                                // Toggle sort direction
                                if (currentFilters.sortBy === sortField) {
                                    currentFilters.sortBy = `${sortField}_desc`;
                                } else if (currentFilters.sortBy === `${sortField}_desc`) {
                                    currentFilters.sortBy = sortField;
                                } else {
                                    currentFilters.sortBy = sortField;
                                }
                                applyFilters();
                            });
                        });

                        // Removed: Export button event listener
                        // Removed: Print button event listener

                        // Refresh button
                        document.getElementById('refreshBtn').addEventListener('click', function() {
                            window.location.reload();
                        });

                        // Toggle advanced filters
                        document.getElementById('toggleFilters').addEventListener('click', function() {
                            const icon = this.querySelector('i');
                            if (this.getAttribute('aria-expanded') === 'true') {
                                icon.className = 'fas fa-sliders-h me-1';
                            } else {
                                icon.className = 'fas fa-chevron-up me-1';
                            }
                        });
                    }

                    function applyFilters() {
                        let visibleRows = 0;
                        const filteredRows = [];

                        // Filter rows
                        seniorRows.forEach(row => {
                            let showRow = true;

                            // Search filter
                            if (currentFilters.search) {
                                const name = row.dataset.name;
                                const sccn = row.dataset.sccn;
                                const searchTerm = currentFilters.search;

                                if (!name.includes(searchTerm) && !sccn.includes(searchTerm)) {
                                    showRow = false;
                                }
                            }

                            // Gender filter
                            if (currentFilters.gender && row.dataset.gender !== currentFilters.gender) {
                                showRow = false;
                            }

                            // Zone filter
                            if (currentFilters.zone && row.dataset.zone !== currentFilters.zone) {
                                showRow = false;
                            }

                            // Age filter
                            const age = parseInt(row.dataset.age);
                            if (currentFilters.minAge && age < parseInt(currentFilters.minAge)) {
                                showRow = false;
                            }
                            if (currentFilters.maxAge && age > parseInt(currentFilters.maxAge)) {
                                showRow = false;
                            }

                            // Status filter
                            if (currentFilters.status && row.dataset.status !== currentFilters.status) {
                                showRow = false;
                            }

                            if (showRow) {
                                filteredRows.push(row);
                                visibleRows++;
                            }

                            // Hide/show row
                            row.style.display = showRow ? '' : 'none';
                        });

                        // Sort filtered rows
                        sortRows(filteredRows);

                        // Show/hide no results message
                        const noResults = document.getElementById('noResults');
                        const seniorTable = document.getElementById('seniorTable');
                        const pagination = document.getElementById('paginationContainer');

                        if (visibleRows === 0) {
                            noResults.style.display = 'block';
                            seniorTable.style.display = 'none';
                            pagination.style.display = 'none';
                        } else {
                            noResults.style.display = 'none';
                            seniorTable.style.display = 'block';

                            // Pagination logic
                            const totalPages = Math.ceil(visibleRows / currentFilters.pageSize);
                            if (totalPages > 1) {
                                setupPagination(totalPages);
                                pagination.style.display = 'block';
                                applyPagination(filteredRows);
                            } else {
                                pagination.style.display = 'none';
                                // Show all rows
                                filteredRows.forEach(row => row.style.display = '');
                            }
                        }

                        // Update results count
                        updateResultsCount(visibleRows);

                        // Update active filters display
                        updateActiveFilters();
                    }

                    function sortRows(rows) {
                        rows.sort((a, b) => {
                            let aVal, bVal;

                            switch(currentFilters.sortBy) {
                                case 'name':
                                    aVal = a.dataset.name;
                                    bVal = b.dataset.name;
                                    return aVal.localeCompare(bVal);

                                case 'name_desc':
                                    aVal = a.dataset.name;
                                    bVal = b.dataset.name;
                                    return bVal.localeCompare(aVal);

                                case 'age':
                                    aVal = parseInt(a.dataset.age);
                                    bVal = parseInt(b.dataset.age);
                                    return aVal - bVal;

                                case 'age_desc':
                                    aVal = parseInt(a.dataset.age);
                                    bVal = parseInt(b.dataset.age);
                                    return bVal - aVal;

                                case 'zone':
                                    aVal = parseInt(a.dataset.zone);
                                    bVal = parseInt(b.dataset.zone);
                                    return aVal - bVal;

                                case 'zone_desc':
                                    aVal = parseInt(a.dataset.zone);
                                    bVal = parseInt(b.dataset.zone);
                                    return bVal - aVal;

                                default:
                                    return 0;
                            }
                        });

                        // Update table order
                        const tbody = document.getElementById('seniorTableBody');
                        tbody.innerHTML = '';
                        rows.forEach(row => tbody.appendChild(row));

                        // Update sort indicators
                        updateSortIndicators();
                    }

                    function updateSortIndicators() {
                        // Remove all sort classes
                        document.querySelectorAll('.sortable').forEach(header => {
                            header.classList.remove('sort-asc', 'sort-desc');
                        });

                        // Add sort class to current sort column
                        const sortField = currentFilters.sortBy.replace('_desc', '');
                        const headers = document.querySelectorAll(`.sortable[data-sort="${sortField}"]`);
                        headers.forEach(header => {
                            if (currentFilters.sortBy.endsWith('_desc')) {
                                header.classList.add('sort-desc');
                            } else {
                                header.classList.add('sort-asc');
                            }
                        });
                    }

                    function setupPagination(totalPages) {
                        const paginationContainer = document.getElementById('paginationContainer');
                        const ul = paginationContainer.querySelector('.pagination');

                        // Clear existing page items (keep prev/next)
                        const pageItems = ul.querySelectorAll('.page-item:not(#prevPage):not(#nextPage)');
                        pageItems.forEach(item => item.remove());

                        // Add page numbers
                        for (let i = 1; i <= totalPages; i++) {
                            const li = document.createElement('li');
                            li.className = `page-item ${i === currentFilters.currentPage ? 'active' : ''}`;
                            li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;

                            li.querySelector('a').addEventListener('click', function(e) {
                                e.preventDefault();
                                currentFilters.currentPage = parseInt(this.dataset.page);
                                applyFilters();
                            });

                            ul.insertBefore(li, document.getElementById('nextPage'));
                        }

                        // Update prev/next buttons
                        const prevBtn = document.getElementById('prevPage');
                        const nextBtn = document.getElementById('nextPage');

                        prevBtn.classList.toggle('disabled', currentFilters.currentPage === 1);
                        nextBtn.classList.toggle('disabled', currentFilters.currentPage === totalPages);

                        prevBtn.querySelector('a').addEventListener('click', function(e) {
                            if (currentFilters.currentPage > 1) {
                                e.preventDefault();
                                currentFilters.currentPage--;
                                applyFilters();
                            }
                        });

                        nextBtn.querySelector('a').addEventListener('click', function(e) {
                            if (currentFilters.currentPage < totalPages) {
                                e.preventDefault();
                                currentFilters.currentPage++;
                                applyFilters();
                            }
                        });
                    }

                    function applyPagination(rows) {
                        const startIndex = (currentFilters.currentPage - 1) * currentFilters.pageSize;
                        const endIndex = startIndex + currentFilters.pageSize;

                        // Hide all rows first
                        seniorRows.forEach(row => row.style.display = 'none');

                        // Show only rows for current page
                        for (let i = startIndex; i < Math.min(endIndex, rows.length); i++) {
                            rows[i].style.display = '';
                        }
                    }

                    function updateResultsCount(visible = totalRecords) {
                        const resultsCount = document.getElementById('resultsCount');
                        resultsCount.textContent = `Showing ${visible} of ${totalRecords} records`;

                        if (visible < totalRecords) {
                            resultsCount.innerHTML += ` <span class="text-primary">(filtered)</span>`;
                        }
                    }

                    function updateActiveFilters() {
                        const activeFiltersContainer = document.getElementById('activeFilters');
                        const filterTagsContainer = document.getElementById('filterTags');
                        filterTagsContainer.innerHTML = '';

                        let hasActiveFilters = false;

                        // Search filter
                        if (currentFilters.search) {
                            hasActiveFilters = true;
                            const tag = createFilterTag('Search', currentFilters.search, 'search');
                            filterTagsContainer.appendChild(tag);
                        }

                        // Gender filter
                        if (currentFilters.gender) {
                            hasActiveFilters = true;
                            const tag = createFilterTag('Gender', currentFilters.gender, 'gender');
                            filterTagsContainer.appendChild(tag);
                        }

                        // Zone filter
                        if (currentFilters.zone) {
                            hasActiveFilters = true;
                            const tag = createFilterTag('Zone', `Zone ${currentFilters.zone}`, 'zone');
                            filterTagsContainer.appendChild(tag);
                        }

                        // Age filter
                        if (currentFilters.minAge || currentFilters.maxAge) {
                            hasActiveFilters = true;
                            let ageText = '';
                            if (currentFilters.minAge && currentFilters.maxAge) {
                                ageText = `${currentFilters.minAge} - ${currentFilters.maxAge}`;
                            } else if (currentFilters.minAge) {
                                ageText = `≥ ${currentFilters.minAge}`;
                            } else {
                                ageText = `≤ ${currentFilters.maxAge}`;
                            }
                            const tag = createFilterTag('Age', ageText, 'age');
                            filterTagsContainer.appendChild(tag);
                        }

                        // Status filter
                        if (currentFilters.status) {
                            hasActiveFilters = true;
                            const tag = createFilterTag('Status', currentFilters.status, 'status');
                            filterTagsContainer.appendChild(tag);
                        }

                        // Sort filter
                        if (currentFilters.sortBy !== 'name') {
                            hasActiveFilters = true;
                            let sortText = '';
                            switch(currentFilters.sortBy) {
                                case 'name_desc': sortText = 'Name (Z-A)'; break;
                                case 'age': sortText = 'Age (Low to High)'; break;
                                case 'age_desc': sortText = 'Age (High to Low)'; break;
                                case 'zone': sortText = 'Zone (1-7)'; break;
                                case 'zone_desc': sortText = 'Zone (7-1)'; break;
                            }
                            const tag = createFilterTag('Sort', sortText, 'sort');
                            filterTagsContainer.appendChild(tag);
                        }

                        activeFiltersContainer.style.display = hasActiveFilters ? 'block' : 'none';
                    }

                    function createFilterTag(label, value, type) {
                        const tag = document.createElement('div');
                        tag.className = 'filter-tag';
                        tag.innerHTML = `
                            <span>${label}: <strong>${value}</strong></span>
                            <button class="remove-filter" data-type="${type}">
                                <i class="fas fa-times"></i>
                            </button>
                        `;

                        tag.querySelector('.remove-filter').addEventListener('click', function() {
                            removeFilter(type);
                        });

                        return tag;
                    }

                    function removeFilter(type) {
                        switch(type) {
                            case 'search':
                                document.getElementById('searchInput').value = '';
                                currentFilters.search = '';
                                document.getElementById('clearSearch').style.display = 'none';
                                break;
                            case 'gender':
                                document.getElementById('genderFilter').value = '';
                                currentFilters.gender = '';
                                break;
                            case 'zone':
                                document.getElementById('zoneFilter').value = '';
                                currentFilters.zone = '';
                                break;
                            case 'age':
                                document.getElementById('minAge').value = '';
                                document.getElementById('maxAge').value = '';
                                currentFilters.minAge = null;
                                currentFilters.maxAge = null;
                                break;
                            case 'status':
                                document.getElementById('statusFilter').value = '';
                                currentFilters.status = '';
                                break;
                            case 'sort':
                                document.getElementById('sortBy').value = 'name';
                                currentFilters.sortBy = 'name';
                                break;
                        }
                        applyFilters();
                    }

                    function resetFilters() {
                        // Reset form inputs
                        document.getElementById('searchInput').value = '';
                        document.getElementById('clearSearch').style.display = 'none';
                        document.getElementById('genderFilter').value = '';
                        document.getElementById('zoneFilter').value = '';
                        document.getElementById('minAge').value = '';
                        document.getElementById('maxAge').value = '';
                        document.getElementById('statusFilter').value = '';
                        document.getElementById('sortBy').value = 'name';
                        document.getElementById('pageSize').value = '25';

                        // Collapse advanced filters
                        const advancedFilters = document.getElementById('advancedFilters');
                        const bsCollapse = new bootstrap.Collapse(advancedFilters, {toggle: false});
                        bsCollapse.hide();

                        // Reset toggle button icon
                        document.getElementById('toggleFilters').querySelector('i').className = 'fas fa-sliders-h me-1';

                        // Reset filter state
                        currentFilters = {
                            search: '',
                            gender: '',
                            zone: '',
                            minAge: null,
                            maxAge: null,
                            status: '',
                            sortBy: 'name',
                            pageSize: 25,
                            currentPage: 1
                        };

                        applyFilters();
                    }

                    // Removed: exportToCSV function
                });
            </script>
}
